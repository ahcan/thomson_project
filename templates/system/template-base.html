{% extends 'base.html' %}
{% block content %}
<script type="text/javascript" src="/static/assets/js/jquery.floatThead.min.js"></script>
<div ng-app="System" class="col-md-12">
    <div class="colpadding col-md-6" ng-controller="ctrl-thomson-HNI">
        <div class="header-device">
            <h2 class="sub-header">Device {{'{{host}'}}}</h2>
            <!-- table total -->
                <div style="display: inline; font-size: 13px; padding-right: 10px; float: right; margin-top:-7px;">
                    <table style="width: 200px; background-color: #edeff2; font-size: 11px;">
                        <tr>
                            <td style="width: 40px; font-size: 14px;"><p>Total:</p></td>
                            <td style="width: 170px;">
                                <table class="table" style="margin-bottom: 0px; background-color: #edeff2;">
                                <tr>
                                    <td style="padding: 1px;">
                                        <div class="progress" style="height: 20px;">
                                        <div class="progressbar progress-bar-info" role="progressbar" aria-valuemax='100' style="width: {{'{{PCStatus.alloccpu}'}}}%;">
                                            <div class="progressbar progress-bar-real" role="progressbar" aria-valuenow="{{'{{PCStatus.cpu}'}}}" aria-valuemin="0" aria-valuemax="100" style="width:{{'{{PCStatus.cpu}'}}}%;"></div>
                                            <p>{{'{{PCStatus.alloccpu}'}}}%</p>
                                        </div>
                                    </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 1px;">
                                        <div class="progress" style="height: 20px;">
                                            <div class="progressbar progress-bar-info" role="progressbar" aria-valuemax='100' style="width: {{'{{PCStatus.allocmem}'}}}%;">
                                                <div class="progressbar progress-bar-real" role="progressbar" aria-valuenow="{{'{{PCStatus.mem}'}}}" aria-valuemin="0" aria-valuemax="100" style="width:{{'{{PCStatus.mem}'}}}%;"></div>
                                                <p>{{'{{PCStatus.allocmem}'}}}%</p>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                </table>
                            </td>
                        </tr>
                    </table>
                </div>
            <!-- end table total -->
        </div> 
        <!-- table Device -->
            <div class="table-responsive colpadding col-md-12">
                <div class="wrapper wrapper-device" style="overflow-y:scroll;">
                    <table class="table table-bordered table-hover table-striped scrollTable">
                        <thead>
                            <th class="col-md-1 sortting" ><a role="button" ng-click="orderByField = 'nid'; reverseSort = !reverseSort">Nodes<i class="glyphicon" ng-show="orderByField=='nid'" ng-class="{'glyphicon-chevron-up': !reverseSort, 'glyphicon-chevron-down': reverseSort}"></i></a></th>
                            <th class="col-md-1">Status</th>
                            <th class="col-md-1">State</th>
                            <th class="col-md-1 sortting"><a role="button" ng-click="orderByField='!jerror'; reverseSort=ture;">Error/Job</th>
                            <!-- <th class="col-md-1">Counter</th> -->
                            <th class="col-md-3 sortting"><a role="button" ng-click="orderByField = 'alloccpu'; reverseSort = !reverseSort">Cpu <i class="glyphicon" ng-show="orderByField=='alloccpu'" ng-class="{'glyphicon-chevron-up': !reverseSort, 'glyphicon-chevron-down': reverseSort}"></i></a></th>
                            <th class="col-md-3 sortting"><a role="button" ng-click="orderByField = 'allocmem'; reverseSort = !reverseSort">Mem <i class="glyphicon" ng-show="orderByField=='allocmem'" ng-class="{'glyphicon-chevron-up': !reverseSort, 'glyphicon-chevron-down': reverseSort}"></i></a></th>
                        </thead>
                        <tbody>
                            <tr ng-repeat="node in lstNodes | orderBy: '-alloccpu' | orderBy:'-jerror' | orderBy: orderByField: reverseSort" ng-click="show_detail(node.nid);">
                                <td class="col-md-1" ng-class="{'alarm': node.jerror >0}">{{'{{node.nid}'}}}</td>
                                <td class="col-md-1" ng-class="{'oke': node.status == 'OK', 'error': node.status == 'ER', 'watting': node.status == 'WAT', 'alarm': node.jerror >0}"><span>{{'{{node.status}'}}}</span></td>
                                <td class="col-md-1" ng-class="{'alarm': node.jerror >0}">{{'{{node.state}'}}}</td>
                                <td class="col-md-1" ng-class="{'alarm': node.jerror >0}">{{'{{node.jerror}'}}}/{{'{{node.jcounter}'}}}</td>
                                <td class="col-md-3" ng-class="{'alarm': node.jerror >0}">
                                    <div class="progress">
                                    <div class="progressbar progress-bar-info" role="progressbar" aria-valuemax='100' style="width: {{'{{node.alloccpu}'}}}%;">
                                        <div class="progressbar progress-bar-real" role="progressbar" aria-valuenow="{{'{{node.cpu}'}}}" aria-valuemin="0" aria-valuemax="100" style="width:{{'{{node.cpu}'}}}%;"></div>
                                        <p>{{'{{node.alloccpu}'}}}%</p>
                                        </div>
                                </div>
                                </td>
                                <td class="col-md-3" ng-class="{'alarm': node.jerror >0}">
                                    <div class="progress">
                                        <div class="progressbar progress-bar-info" role="progressbar" aria-valuemax='100' style="width: {{'{{node.allocmem}'}}}%;">
                                            <div class="progressbar progress-bar-real" role="progressbar" aria-valuenow="{{'{{node.mem}'}}}" aria-valuemin="0" aria-valuemax="100" style="width:{{'{{node.mem}'}}}%;"></div>
                                            <p>{{'{{node.allocmem}'}}}%</p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        <!-- end table Device -->
        <!-- table Job -->
            <div class="col-md-12 table-responsive colpadding" ng-show="isJob">
                <h4 class="node-h4">
                    Node:&nbsp{{'{{node.nid}'}}}
                </h4>
                <div class="wrapper wrapper-node" style="overflow-y: scroll;">
                    <table class="table table-bordered table-hover table-striped scrollTable">
                        <thead>
                            <tr>
                                <th style="width: 2%;">#</th>
                                <th style="width: 4%;">Job ID</th>
                                <th style="width: 40%;">Job name</th>
                                <th style="width: 2%;">Status</th>
                                <th style="width: 10%;">State</th>
                                <th style="width: 40%;">Workflow Name</th>
                                <th style="width: 2%;">Edit</th>    
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="job in node.job_list">
                                <td style="width: 2%;" ng-click="showLog(job.jid, job.jname);"><span>{{'{{$index + 1}'}}}</span></td>
                                <td style="width: 4%;" ng-click="showLog(job.jid, job.jname);"><span>{{'{{job.jid}'}}}</span></td>
                                <td style="width: 40%;" ng-click="showLog(job.jid, job.jname);"><span>{{'{{job.jname}'}}}</span></td>
                                <td style="width: 2%;" ng-click="showLog(job.jid, job.jname);"><span ng-class="{'alarm': job.status == 'Critical'}">{{'{{job.status}'}}}</span></td>
                                <td style="width: 10%;" ng-click="showLog(job.jid, job.jname);"><span>{{'{{job.state}'}}}</span></td>
                                <td style="width: 40%;" ng-click="showLog(job.jid, job.jname);"><span>{{'{{job.wname}'}}}</span></td>
                                <td style="width: 2%;">
                                    <button type="button" name="tbnStart{{'{{job.jid}'}}}" class="btn btn-success btn-xs glyphicon glyphicon-play" title="Start" ng-hide="job.state == 'Running'" ng-click="startJob(job.jid, node.nid);"></button>
                                    <button type="button" name="tbnStop{{'{{job.jid}'}}}" class="btn btn-danger btn-xs glyphicon glyphicon-stop" title="Stop" ng-show="job.state == 'Running'" ng-click="stopJob(job.jid, node.nid);"></button> 
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        <!-- end table Job -->
        <!-- table Real Time -->
            <div class="col-md-12 table-responsive colpadding" ng-hide="isRealTime">
                <h4 class="node-h4">Real Time</h4>
                <div class="wrapper" ng-class="{'wrapper-log': isJob, 'wrapper-log-1': !isJob}" style="overflow-y: scroll;">
                    <table class="table table-bordered table-hover table-striped scrollTable">
                        <thead>
                            <tr>
                                <th style="width: 4%;">#</th>
                                <th style="width: 2%;">Serverily</th>
                                <th style="width: 2%;">Node</th>
                                <th style="width: 20%;">Resource</th>
                                <th style="width: 20%;">Description</th>
                                <th style="width: 10%;">Open date</th>
                                <th style="width: 10%;">Clean date</th>
                                <th style="width: 4%;">Job ID</th>
                                <th style="width: 8%;">Job name</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="log in log_list | filter:search | filter:filterBySev | orderBy: '-opdate'" ng-class="{'warning': nowDate-log.opdate<=180000}">
                                <td style="width: 4%;"><span>{{'{{$index + 1}'}}}</span></td>
                                <td style="width: 2%;"><span>{{'{{log.sev}'}}}</span></td>
                                <td style="width: 2%;"><span>{{'{{log.nid}'}}}</span></td>
                                <td style="width: 20%;"><span>{{'{{log.res}'}}}</span></td>
                                <td style="width: 20%;"><span>{{'{{log.desc}'}}}</span></td>
                                <td style="width: 10%;"><span>{{'{{log.opdate | date:"dd-MM-yyyy HH:mm:ss"}'}}}</span></td>
                                <td style="width: 10%;"><span>{{'{{log.cldate | date:"dd-MM-yyyy HH:mm:ss"}'}}}</span></td>
                                <td style="width: 4%;"><span>{{'{{log.jid}'}}}</span></td>
                                <td style="width: 10%;"><span>{{'{{log.jname}'}}}</span></td>
                            </tr>
                        </tbody>
                        <tfoot>
                        <tr>
                            <td colspan="8" class="text-center">Total: {{'{{log_list.length}'}}}</td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        <!-- end table Real Time -->
        <!-- table Log -->
        <div class="col-md-12 table-responsive colpadding" ng-show="isRealTime">
            <h4 class="node-h4">Log: &nbsp {{'{{job_name}'}}}</h4>
            <div class="wrapper wrapper-log" style="overflow-y: scroll;">
                <table class="table table-bordered table-panel table-hover table-striped scrollTable">
                    <thead class="width-col-default">
                        <th style="width: 5%;"><label><span>Severity</span></label></th>
                        <th style="width: 10%;"><label><span>Catogory</span></label></th>
                        <th style="width: 5%;"><label><span>Node</span></label></th>
                        <th style="width: 20%;"><label><span>Resource</span></label></th>
                        <th style="width: 40%;"><label><span>Descriptipn</span></label></th>
                        <th style="width: 10%;"><label><span>Raising Date</span></label></th>
                        <th style="width: 10%;" ><label><span>Cealrning Date</span></label></th>
                    </thead>
                    <tbody>
                        <tr ng-repeat="log in lstLogJob | orderBy: '-opdate'">
                            <td style="width: 5%;"><span>{{'{{log.sev}'}}}</span></td>
                            <td style="width: 10%;"><span>{{'{{log.cat}'}}}</span></td>
                            <td style="width: 5%;"><span>{{'{{log.nid}'}}}</span></td>
                            <td style="width: 20%;"><span>{{'{{log.res}'}}}</span></td>
                            <td style="width: 40%;"><span>{{'{{log.desc}'}}}</span></td>
                            <td style="width: 10%;"><span>{{'{{log.opdate | date:"dd-MM-yyyy HH:mm:ss" }'}}}</span></td>
                            <td style="width: 10%;"><span>{{'{{log.cldate | date:"dd-MM-yyyy HH:mm:ss" }'}}}</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- end table Log -->
    </div>

    <div class="colpadding col-md-6" ng-controller="ctrl-thomson-HCM">
        <div class="header-device">
            <h2 class="sub-header">Device {{'{{host}'}}}</h2>
            <!-- table total -->
                <div style="display: inline; font-size: 13px; padding-right: 10px; float: right; margin-top:-7px;">
                    <table style="width: 200px; background-color: #edeff2; font-size: 11px;">
                        <tr>
                            <td style="width: 40px; font-size: 14px;"><p>Total:</p></td>
                            <td style="width: 170px;">
                                <table class="table" style="margin-bottom: 0px; background-color: #edeff2;">
                                <tr>
                                    <td style="padding: 1px;">
                                        <div class="progress" style="height: 20px;">
                                        <div class="progressbar progress-bar-info" role="progressbar" aria-valuemax='100' style="width: {{'{{PCStatus.alloccpu}'}}}%;">
                                            <div class="progressbar progress-bar-real" role="progressbar" aria-valuenow="{{'{{PCStatus.cpu}'}}}" aria-valuemin="0" aria-valuemax="100" style="width:{{'{{PCStatus.cpu}'}}}%;"></div>
                                            <p>{{'{{PCStatus.alloccpu}'}}}%</p>
                                        </div>
                                    </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 1px;">
                                        <div class="progress" style="height: 20px;">
                                            <div class="progressbar progress-bar-info" role="progressbar" aria-valuemax='100' style="width: {{'{{PCStatus.allocmem}'}}}%;">
                                                <div class="progressbar progress-bar-real" role="progressbar" aria-valuenow="{{'{{PCStatus.mem}'}}}" aria-valuemin="0" aria-valuemax="100" style="width:{{'{{PCStatus.mem}'}}}%;"></div>
                                                <p>{{'{{PCStatus.allocmem}'}}}%</p>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                </table>
                            </td>
                        </tr>
                    </table>
                </div>
            <!-- end table total -->
        </div> 
        <!-- table Device -->
            <div class="table-responsive colpadding col-md-12">
                <div class="wrapper wrapper-device" style="overflow-y:scroll;">
                    <table class="table table-bordered table-hover table-striped scrollTable">
                        <thead>
                            <th class="col-md-1 sortting" ><a role="button" ng-click="orderByField = 'nid'; reverseSort = !reverseSort">Nodes<i class="glyphicon" ng-show="orderByField=='nid'" ng-class="{'glyphicon-chevron-up': !reverseSort, 'glyphicon-chevron-down': reverseSort}"></i></a></th>
                            <th class="col-md-1">Status</th>
                            <th class="col-md-1">State</th>
                            <th class="col-md-1 sortting"><a role="button" ng-click="orderByField='!jerror'; reverseSort=ture;">Error/Job</th>
                            <!-- <th class="col-md-1">Counter</th> -->
                            <th class="col-md-3 sortting"><a role="button" ng-click="orderByField = 'alloccpu'; reverseSort = !reverseSort">Cpu <i class="glyphicon" ng-show="orderByField=='alloccpu'" ng-class="{'glyphicon-chevron-up': !reverseSort, 'glyphicon-chevron-down': reverseSort}"></i></a></th>
                            <th class="col-md-3 sortting"><a role="button" ng-click="orderByField = 'allocmem'; reverseSort = !reverseSort">Mem <i class="glyphicon" ng-show="orderByField=='allocmem'" ng-class="{'glyphicon-chevron-up': !reverseSort, 'glyphicon-chevron-down': reverseSort}"></i></a></th>
                        </thead>
                        <tbody>
                            <tr ng-repeat="node in lstNodes | orderBy: '-alloccpu' | orderBy:'-jerror' | orderBy: orderByField: reverseSort" ng-click="show_detail(node.nid);">
                                <td class="col-md-1" ng-class="{'alarm': node.jerror >0}">{{'{{node.nid}'}}}</td>
                                <td class="col-md-1" ng-class="{'oke': node.status == 'OK', 'error': node.status == 'ER', 'watting': node.status == 'WAT', 'alarm': node.jerror >0}"><span>{{'{{node.status}'}}}</span></td>
                                <td class="col-md-1" ng-class="{'alarm': node.jerror >0}">{{'{{node.state}'}}}</td>
                                <td class="col-md-1" ng-class="{'alarm': node.jerror >0}">{{'{{node.jerror}'}}}/{{'{{node.jcounter}'}}}</td>
                                <td class="col-md-3" ng-class="{'alarm': node.jerror >0}">
                                    <div class="progress">
                                    <div class="progressbar progress-bar-info" role="progressbar" aria-valuemax='100' style="width: {{'{{node.alloccpu}'}}}%;">
                                        <div class="progressbar progress-bar-real" role="progressbar" aria-valuenow="{{'{{node.cpu}'}}}" aria-valuemin="0" aria-valuemax="100" style="width:{{'{{node.cpu}'}}}%;"></div>
                                        <p>{{'{{node.alloccpu}'}}}%</p>
                                        </div>
                                </div>
                                </td>
                                <td class="col-md-3" ng-class="{'alarm': node.jerror >0}">
                                    <div class="progress">
                                        <div class="progressbar progress-bar-info" role="progressbar" aria-valuemax='100' style="width: {{'{{node.allocmem}'}}}%;">
                                            <div class="progressbar progress-bar-real" role="progressbar" aria-valuenow="{{'{{node.mem}'}}}" aria-valuemin="0" aria-valuemax="100" style="width:{{'{{node.mem}'}}}%;"></div>
                                            <p>{{'{{node.allocmem}'}}}%</p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        <!-- end table Device -->
        <!-- table Job -->
            <div class="col-md-12 table-responsive colpadding" ng-show="isJob">
                <h4 class="node-h4">
                    Node:&nbsp{{'{{node.nid}'}}}
                </h4>
                <div class="wrapper wrapper-node" style="overflow-y: scroll;">
                    <table class="table table-bordered table-hover table-striped scrollTable">
                        <thead>
                            <tr>
                                <th style="width: 2%;">#</th>
                                <th style="width: 4%;">Job ID</th>
                                <th style="width: 40%;">Job name</th>
                                <th style="width: 2%;">Status</th>
                                <th style="width: 10%;">State</th>
                                <th style="width: 40%;">Workflow Name</th>
                                <th style="width: 2%;">Edit</th>    
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="job in node.job_list">
                                <td style="width: 2%;" ng-click="showLog(job.jid, job.jname);"><span>{{'{{$index + 1}'}}}</span></td>
                                <td style="width: 4%;" ng-click="showLog(job.jid, job.jname);"><span>{{'{{job.jid}'}}}</span></td>
                                <td style="width: 40%;" ng-click="showLog(job.jid, job.jname);"><span>{{'{{job.jname}'}}}</span></td>
                                <td style="width: 2%;" ng-click="showLog(job.jid, job.jname);"><span ng-class="{'alarm': job.status == 'Critical'}">{{'{{job.status}'}}}</span></td>
                                <td style="width: 10%;" ng-click="showLog(job.jid, job.jname);"><span>{{'{{job.state}'}}}</span></td>
                                <td style="width: 40%;" ng-click="showLog(job.jid, job.jname);"><span>{{'{{job.wname}'}}}</span></td>
                                <td style="width: 2%;">
                                    <button type="button" name="tbnStart{{'{{job.jid}'}}}" class="btn btn-success btn-xs glyphicon glyphicon-play" title="Start" ng-hide="job.state == 'Running'" ng-click="startJob(job.jid, node.nid);"></button>
                                    <button type="button" name="tbnStop{{'{{job.jid}'}}}" class="btn btn-danger btn-xs glyphicon glyphicon-stop" title="Stop" ng-show="job.state == 'Running'" ng-click="stopJob(job.jid, node.nid);"></button> 
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        <!-- end table Job -->
        <!-- table Real Time -->
            <div class="col-md-12 table-responsive colpadding" ng-hide="isRealTime">
                <h4 class="node-h4">Real Time</h4>
                <div class="wrapper" ng-class="{'wrapper-log': isJob, 'wrapper-log-1': !isJob}" style="overflow-y: scroll;">
                    <table class="table table-bordered table-hover table-striped scrollTable">
                        <thead>
                            <tr>
                                <th style="width: 4%;">#</th>
                                <th style="width: 2%;">Serverily</th>
                                <th style="width: 2%;">Node</th>
                                <th style="width: 20%;">Resource</th>
                                <th style="width: 20%;">Description</th>
                                <th style="width: 10%;">Open date</th>
                                <th style="width: 10%;">Clean date</th>
                                <th style="width: 4%;">Job ID</th>
                                <th style="width: 8%;">Job name</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="log in log_list | filter:search | filter:filterBySev | orderBy: '-opdate'" ng-class="{'warning': nowDate-log.opdate<=180000}">
                                <td style="width: 4%;"><span>{{'{{$index + 1}'}}}</span></td>
                                <td style="width: 2%;"><span>{{'{{log.sev}'}}}</span></td>
                                <td style="width: 2%;"><span>{{'{{log.nid}'}}}</span></td>
                                <td style="width: 20%;"><span>{{'{{log.res}'}}}</span></td>
                                <td style="width: 20%;"><span>{{'{{log.desc}'}}}</span></td>
                                <td style="width: 10%;"><span>{{'{{log.opdate | date:"dd-MM-yyyy HH:mm:ss"}'}}}</span></td>
                                <td style="width: 10%;"><span>{{'{{log.cldate | date:"dd-MM-yyyy HH:mm:ss"}'}}}</span></td>
                                <td style="width: 4%;"><span>{{'{{log.jid}'}}}</span></td>
                                <td style="width: 10%;"><span>{{'{{log.jname}'}}}</span></td>
                            </tr>
                        </tbody>
                        <tfoot>
                        <tr>
                            <td colspan="8" class="text-center">Total: {{'{{log_list.length}'}}}</td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        <!-- end table Real Time -->
        <!-- table Log -->
        <div class="col-md-12 table-responsive colpadding" ng-show="isRealTime">
            <h4 class="node-h4">Log: &nbsp {{'{{job_name}'}}}</h4>
            <div class="wrapper wrapper-log" style="overflow-y: scroll;">
                <table class="table table-bordered table-panel table-hover table-striped scrollTable">
                    <thead class="width-col-default">
                        <th style="width: 5%;"><label><span>Severity</span></label></th>
                        <th style="width: 10%;"><label><span>Catogory</span></label></th>
                        <th style="width: 5%;"><label><span>Node</span></label></th>
                        <th style="width: 20%;"><label><span>Resource</span></label></th>
                        <th style="width: 40%;"><label><span>Descriptipn</span></label></th>
                        <th style="width: 10%;"><label><span>Raising Date</span></label></th>
                        <th style="width: 10%;" ><label><span>Cealrning Date</span></label></th>
                    </thead>
                    <tbody>
                        <tr ng-repeat="log in lstLogJob | orderBy: '-opdate'">
                            <td style="width: 5%;"><span>{{'{{log.sev}'}}}</span></td>
                            <td style="width: 10%;"><span>{{'{{log.cat}'}}}</span></td>
                            <td style="width: 5%;"><span>{{'{{log.nid}'}}}</span></td>
                            <td style="width: 20%;"><span>{{'{{log.res}'}}}</span></td>
                            <td style="width: 40%;"><span>{{'{{log.desc}'}}}</span></td>
                            <td style="width: 10%;"><span>{{'{{log.opdate | date:"dd-MM-yyyy HH:mm:ss" }'}}}</span></td>
                            <td style="width: 10%;"><span>{{'{{log.cldate | date:"dd-MM-yyyy HH:mm:ss" }'}}}</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- end table Log -->
    </div>
</div>
<script type="text/javascript">
    var app =angular.module('System', []);
    app.controller('ctrl-thomson-HNI', function($scope, $http, $timeout, $window) {
    // body...
        $scope.host = "thomson-lab";
        $scope.isRealTime = false;
        $scope.isJob = false;
        $scope.reloadNodes = function(){
            $http.get("/system/api/"+$scope.host+"/nstatus/").then(function(reponse){
                $scope.lstNodes = reponse.data;
            });
            $timeout(function() {
                // $scope.reloadNodes();
            }, 20000)
        };
        $scope.reloadDevice = function(){
            $http.get("/system/api/"+$scope.host+"/status/").then(function(reponse){
                $scope.PCStatus = reponse.data[0];
                // console.log($scope.PCStatus);
            });
            $timeout(function() {
                // $scope.reloadDevice();
            }, 20000)
        };
        $scope.show_detail = function(node_id) {
            // $window.location.href = '/system/detail-node/'+node_id+'/'
            $scope.lstLogJob = '';
            $scope.isRealTime = false;
            $scope.isJob = true
            $http({
                method:'GET',
                url:'/system/api/'+$scope.host+'/'+node_id+'/',
            }).then(function(response){
                $scope.node = response.data[0];
                $scope.job_list = response.data[0].job_list;
                // console.log($scope.job_list);
            });
        };
        $scope.startJob = function(job_id, node_id){
            if($window.confirm("Confirm Start Job: "+job_id)){
                $http({
                method: 'PUT',
                url: '/job/api/' + $scope.host + '/' + job_id + '/start/',
                }).then(function(response){
                    if (response.status == 202) {
                        $window.alert(response.data.message);
                        $scope.show_detail(node_id);
                    }
                });
            }
        };
        $scope.stopJob = function(job_id, node_id){
            if($window.confirm("Confirm Stop Job: "+job_id)){
                $http({
                method: 'PUT',
                url: '/job/api/'+ $scope.host + '/'+job_id + '/abort/',
                }).then(function(response){
                    if (response.status == 202) {
                    $window.alert(response.data.message);
                    $scope.show_detail(node_id);
                    }
                });
            }
        };
        $scope.showLog = function(job_id, job_name){
            $scope.job_name = job_name;
            $scope.isRealTime = true;
            $http({
                method: 'GET',
                url: '/log/api/'+ $scope.host +'/'+ job_id +'/',
            }).then(function(response){
                if (response.status == 200){
                    $scope.lstLogJob = response.data;
                    console.log(response.data);
                }else{
                    console.log("Error");
                }
            });
        };
        $scope.loadAllLog = function(){
            $scope.nowDate = +new Date();
            $http({
                method: 'GET',
                url: '/log/api/'+$scope.host+'/log/',
            }).then(function (response){
                $scope.log_list = response.data;
            });
            $timeout(function(){
                $scope.loadAllLog();
            }, 10000);
        };
        $scope.reverseSort = false;
        $scope.reloadDevice();
        $scope.reloadNodes();
        $scope.loadAllLog();
    });
        app.controller('ctrl-thomson-HCM', function($scope, $http, $timeout, $window) {
    // body...
        $scope.host = "thomson-hcm";
        $scope.isRealTime = false;
        $scope.isJob = false;
        $scope.reloadNodes = function(){
            $http.get("/system/api/"+$scope.host+"/nstatus/").then(function(reponse){
                $scope.lstNodes = reponse.data;
            });
            $timeout(function() {
                // $scope.reloadNodes();
            }, 20000)
        };
        $scope.reloadDevice = function(){
            $http.get("/system/api/"+$scope.host+"/status/").then(function(reponse){
                $scope.PCStatus = reponse.data[0];
                // console.log($scope.PCStatus);
            });
            $timeout(function() {
                // $scope.reloadDevice();
            }, 20000)
        };
        $scope.show_detail = function(node_id) {
            // $window.location.href = '/system/detail-node/'+node_id+'/'
            $scope.lstLogJob = '';
            $scope.isRealTime = false;
            $scope.isJob = true
            $http({
                method:'GET',
                url:'/system/api/'+$scope.host+'/'+node_id+'/',
            }).then(function(response){
                $scope.node = response.data[0];
                $scope.job_list = response.data[0].job_list;
                // console.log($scope.job_list);
            });
        };
        $scope.startJob = function(job_id, node_id){
            if($window.confirm("Confirm Start Job: "+job_id)){
                $http({
                method: 'PUT',
                url: '/job/api/' + job_id + '/start/',
                }).then(function(response){
                    if (response.status == 202) {
                        $window.alert(response.data.message);
                        $scope.show_detail(node_id);
                    }
                });
            }
        };
        $scope.stopJob = function(job_id, node_id){
            if($window.confirm("Confirm Stop Job: "+job_id)){
                $http({
                method: 'PUT',
                url: '/job/api/'+ job_id + '/abort/',
                }).then(function(response){
                    if (response.status == 202) {
                    $window.alert(response.data.message);
                    $scope.show_detail(node_id);
                    }
                });
            }
        };
        $scope.showLog = function(job_id, job_name){
            $scope.job_name = job_name;
            $scope.isRealTime = true;
            $http({
                method: 'GET',
                url: '/log/api/'+$scope.host+ '/'+ job_id +'/',
            }).then(function(response){
                if (response.status == 200){
                    $scope.lstLogJob = response.data;
                    console.log(response.data);
                }else{
                    console.log("Error");
                }
            });
        };
        $scope.loadAllLog = function(){
            $scope.nowDate = +new Date();
            $http({
                method: 'GET',
                url: '/log/api/'+$scope.host+'/log/',
            }).then(function (response){
                $scope.log_list = response.data;
            });
            $timeout(function(){
                $scope.loadAllLog();
            }, 10000);
        };
        $scope.reverseSort = false;
        $scope.reloadDevice();
        $scope.reloadNodes();
        $scope.loadAllLog();
    });
</script>
<script type="text/javascript">
    var $scroll = $('table.scrollTable');
    $scroll.floatThead({
        scrollContainer: function($table){
        return $table.closest('.wrapper');
        }
    });
</script>
{% endblock %}