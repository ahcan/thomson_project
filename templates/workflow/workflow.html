{% extends 'base.html' %}
{% block content %}
<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
	<h2 class="sub-header">Workflows</h2>
	<div class="table-responsive" ng-app="Workflow" ng-controller="workflowCtrl">
		<table class="table table-bordered table-hover table-striped">
			<thead>
				<tr>
					<th>STT</th>
					<th>Name</th>
					<th>Workflow ID</th>
					<th>Pubver</th>
					<th>Priver</th>
					<th>Option</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="workflow in workflow_list">
					<td>{{'{{$index + 1}'}}}</td>
					<td>{{'{{workflow.name}'}}}</td>
					<td ng-mouseenter="showinfo(workflow.wid)"><p uib-tooltip-html="text">{{'{{workflow.wid}'}}}</p></td>
					<td>{{'{{workflow.pubver}'}}}</td>
					<td>{{'{{workflow.priver}'}}}</td>
					<td>Add job</td>
				</tr>
			</tbody>
			<tr>
				<td colspan="7" class="text-center">Total: {{'{{total}'}}}</td>
			</tr>
			</tfoot>
		</table>
	</div>
</div>
<script>
	var app = angular.module('Workflow',['ui.bootstrap']).config(['$tooltipProvider', function ($tooltipProvider) {
        $tooltipProvider.options({
            placement: 'bottom',
             trigger: 'mouseenter',
        });
    }])
	app.controller("workflowCtrl", function ($scope,$http,$timeout,$element,$sce){
		$scope.reload = function () {
			$scope.total = 0;
			$http.get('/workflow/api/workflow/').
			then(function (response) {
				$scope.workflow_list = response.data;
				$scope.total = $scope.workflow_list.length;
				console.log($scope.workflow_list);
			});
			$timeout(function(){
				$scope.reload();
			},10000)
		};
		$scope.reload();
		$scope.showinfo = function(id){
			var tootcontents = '<div>loading....</div>';
			$http.get('/workflow/api/workflow/'+id+'/').then(
				function(response){
					var oj = response.data[0];
					var vid = oj.id;
					var vcategory ="category:\t"+oj.category;
					var vname ="name:\t"+oj.name;
					var vpagrams;
					for(param in oj.params){
						vparams = "<p>"+oj.params[param].name+":\t"+oj.params[param].value+"</p>"
					}
					tootcontents ="<div class='showinfo'>"+vcategory+"</br>"+vname+"</br>"+vparams+"</div>";
					$scope.text = $sce.trustAsHtml(tootcontents);
					// console.log(oj);
				});	
			$scope.text = $sce.trustAsHtml(tootcontents);
		}
	});
	

</script>
{% endblock %}

