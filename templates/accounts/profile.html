{% extends 'base.html' %}
{% block content %}
<div ng-app="ProfileApp" ng-controller="ProfileCtrl">
    <div class="container">
        <div class="row">
            <div class="col-md-7 "><!-- User profile -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 >User Profile</h4>
                    </div>
                    <div class="panel-body">
                        <div class="box box-info">
                            <div class="box-body">
                                <div class="col-sm-6">
                                    <div  align="center">
                                        <img alt="User Pic" src="https://x1.xingassets.com/assets/frontend_minified/img/users/nobody_m.original.jpg" id="profile-image1" class="img-circle img-responsive">
                                        <input id="profile-image-upload" class="hidden" type="file">
                                        <div style="color:#999;" >click here to change profile image</div>
                                        <!--Upload Image Js And Css--> 
                                    </div>
                                    <br>
                                    <!-- /input-group -->
                                </div>
                                <div class="col-sm-6">
                                    <div>
                                        <span class="col-sm-12">
                                            <h4 style="color:#00b1b1;">{{'{{profile.first_name}'}}} {{'{{profile.last_name}'}}}
                                                <a href="#profileModal" role="button" data-toggle="modal">
                                                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                                                </a>
                                            </h4>
                                        </span>
                                        <span class="col-sm-4">
                                            Username
                                        </span>
                                        <span class="col-sm-8">
                                            <p>{{'{{profile.username}'}}}</p>
                                        </span>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                                <hr style="margin:5px 0 5px 0;">
                                <div class="col-sm-5 col-xs-6 tital " >First Name:</div><div class="col-sm-7 col-xs-6 ">{{'{{profile.first_name}'}}}</div>
                                <div class="clearfix"></div>
                                <div class="bot-border"></div>
                                <div class="col-sm-5 col-xs-6 tital " >Last Name:</div><div class="col-sm-7"> {{'{{profile.last_name}'}}}</div>
                                <div class="clearfix"></div>
                                <div class="col-sm-5 col-xs-6 tital " >Email:</div><div class="col-sm-7"> {{'{{profile.email}'}}}</div>
                                <div class="clearfix"></div>
                                <div class="bot-border"></div>
                                <div class="col-sm-5 col-xs-6 tital " >Date Of Joining:</div><div class="col-sm-7">{{'{{profile.date_joined * 1000 | date: "dd-M-yyyy HH:mm:ss"}'}}}</div>
                                <div class="clearfix"></div>
                                <div class="bot-border"></div>
                                <div class="col-sm-5 col-xs-6 tital " >Last login:</div><div class="col-sm-7">{{'{{profile.last_login * 1000 | date: "dd-M-yyyy HH:mm:ss"}'}}}</div>
                                <div class="clearfix"></div>
                            <!-- /.box-body -->
                            </div>
                        </div><!-- /.box info -->
                    </div> <!-- end panel body -->
                </div><!-- end panel parent -->
            </div><!-- End user profle col-md-7 -->
            <div class="col-md-5 "><!-- Change password -->
                <div class="panel panel-default">
                    <div class="panel-heading"><!-- header -->
                        <h4>Password change</h4>
                    </div><!-- end header -->
                    <div class="panel-body"><!-- body -->
                        <form class="form-horizontal">
                            <fieldset>
                                <!-- Password input-->
                                <div class="form-group">
                                    <label class="col-md-4 control-label" for="piCurrPass">Old password</label>
                                    <div class="col-md-7">
                                        <input id="id_old_password" name="old_password" type="password" ng-model="user.oldpassword" ng-keypress="checkIfEnterKeyWasPressed($event)" class="form-control input-md" required="">
                                        
                                    </div>
                                </div>
                                <!-- Password input-->
                                <div class="form-group">
                                    <label class="col-md-4 control-label" for="piNewPass">New password</label>
                                    <div class="col-md-7">
                                        <input id="id_new_password1" name="new_password1" type="password" ng-model="user.newpassword" ng-keypress="checkIfEnterKeyWasPressed($event)" class="form-control input-md" required="">
                                        
                                    </div>
                                </div>
                                <!-- Password input-->
                                <div class="form-group">
                                    <label class="col-md-4 control-label" for="piNewPassRepeat">New password comfirmation</label>
                                    <div class="col-md-7">
                                        <input id="id_new_password2" name="new_password2" type="password" ng-model="user.retypepassword" ng-keypress="checkIfEnterKeyWasPressed($event)"placeholder="" class="form-control input-md" required="">
                                        
                                    </div>
                                </div>
                                <!-- Button (Double) -->
                                <div class="form-group">
                                    <label class="col-md-4 control-label" for="bCancel"></label>
                                    <div class="col-md-8">
                                        <input type="button" value="Change my password" class="btn btn-success" ng-click="pasword_change()"/>
                                    </div>
                                </div>

                            </fieldset>
                        </form>
                    </div><!-- end body -->
                </div>
            </div><!-- End change password -->
        </div>
        <script>
        $(function() {
        $('#profile-image1').on('click', function() {
        $('#profile-image-upload').click();
        });
        });
        </script>
    </div>

  <!-- user profile modal-->
  <div id="profileModal" class="modal fade">
    <div class="modal-dialog">
      <div class="modal-content">
        <form class="well form-horizontal" method="post">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Edit profile</h4>
          </div>
          <div class="modal-body">
            <!-- Event -->
            <div class="form-group">
              <label class="col-md-3 control-label">First name</label>
              <div class="col-md-9 selectContainer">
                <div class="input-group">
                  <span class="input-group-addon"><i class="glyphicon glyphicon-pencil"></i></span>
                  <input type="text" class="form-control" placeholder="Frist name" ng-model="profile.first_name">
                </div>
              </div>
            </div>
            <!-- Name -->
            <div class="form-group" >
              <label class="col-md-3 control-label">Lastname</label>
              <div class="col-md-9 selectContainer">
                <div class="input-group">
                  <span class="input-group-addon"><i class="glyphicon glyphicon-pencil"></i></span>
                  <input type="text" class="form-control" placeholder="Last name" ng-model="profile.last_name">
              </div>
            </div>
          </div>
          <!-- Source -->
          <div class="form-group">
            <label class="col-md-3 control-label">Email</label>
            <div class="col-md-9 inputGroupContainer">
              <div class="input-group">
                <span class="input-group-addon"><i class="glyphicon glyphicon-pencil"></i></span>
                <input type="text" class="form-control" placeholder="example@domain.com" ng-model="profile.email">
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-success" ng-click="save_profile()">Save <span class="glyphicon glyphicon-save"></span></button>
        </div>
      </form>
    </div>
  </div>
  <!-- End user modal -->
</div><!-- END Container -->

<script type="text/javascript">
var app = angular.module('ProfileApp', []);
app.controller('ProfileCtrl', function($scope, $http, $window) {
    $scope.onload = function() {
        $http.get("/accounts/api/profile")
        .then(function(response) {
            $scope.profile = response.data[0];
            console.log($scope.profile);
        });
    };
    $scope.onload();
    // Edit profille
    $scope.save_profile = function() {
        console.log($scope.profile);
        $http({
            method : 'POST',
            url : '/accounts/profile/',
            data : $scope.profile
        }).then(function(response){
            if(response.status == 203){
                $window.alert(response.data.detail);
            }
            else
            if (response.status == 202){
                $window.alert(response.data.detail);
                $scope.onload();
                $('#profileModal').modal('hide');
            }
        });
    };
    // End edit profile
    // Password
    //Check keypress is Enter
    $scope.checkIfEnterKeyWasPressed = function($event){
        var keyCode = $event.which || $event.keyCode;
            if (keyCode === 13) {
                $scope.pasword_change()
        }
    };
    $scope.pasword_change = function () {
        $http({
            method : 'POST',
            url : '/accounts/password/',
            data : $scope.user
        }).then(function(response){
            if(response.status == 203){
                $window.alert(response.data.detail);
            }
            else
            if (response.status == 202){
                $window.alert(response.data.detail);
                $window.location.href='/accounts/login/';
            }
        });
    }; 
    // End password
});
</script>

{% endblock %}